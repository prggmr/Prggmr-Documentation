<h2>
    Prggmr Interactive Console ( iConsole ) - <span class="red">Advanced</span>
</h2>
<p>
    The following code will demonstrate how to create a interactive console such as the unix console written using only PHP which allows
    for user logins and a inifite number of custom commands, the example is avaliable for download and it is recommended to download, install
    and run this example to understand what we will be covering.
</p>
<h2>
    Download, Requirements, Installation &amp; Run
</h2>
<ul>
    <li>
        <h3>
            Download Link
        </h3>
        <p>
            <a href="/examples/interactive_console/interactive_console.zip">Zip Archive</a>
        </p>
    </li>
    <li>
        <h3>
            Requirements
        </h3>
        <p>
            Linux
        </p>
    </li>
    <li>
        <h3>
            Installation
        </h3>
        <p>
            Extract the archive to your desired location.
        </p>
        <p>
            Set the "console" file to have executable permissions
        </p>
    </li>
    <li>
        <h3>
            Running the iconsole
        </h3>
        <p>
            Simply navigate to the extraction path and execute the "console" file.
        </p>
        <pre class="prettyprint linenums">
cd /path/to/iconsole/extraction
./console
        </pre>
    </li>
</ul>
<h2>
    The Structure
</h2>
<p>
    Before we dive into the code we need to setup our directory structure.
<pre class="prettyprint linenums">
|- interactive_console # the root
    |- databases/ # path to our sqlite databases
    |- events/ # path to our event files which will be scanned and included on load
    |- lib/ # the prggmr library
    |- modules/ # the core modules which power iconsole
    |- console # the php file containing our app code and our single entry point
</pre>
<h2>
    The Modules
</h2>
<ul>
    <li>
        <h3>
            modules/console.php
        </h3>
        <p>
            Let's begin by building from the ground up, our first task is to create a simple event object that will act as an abstraction
            object that will provide a means of outputting and reciving data via the console and will be used to extend all other events in our app.
        </p>
<pre class="prettyprint linenums">
namespace iconsole;

/**
 * Iconsole Prggmr Interactive Console
 *
 * @author Nickolas Whiting
 * @date February 17th, 2011
 */

/**
 * The console event allows for a event based interactive
 * console using php code, the class provides methods
 * for printing console strings and receiving feedback
 * using events, the class does not provide the actual
 * data but an interface for subscribing to the common events
 */

class Console extends \prggmr\Event
{
    public $_linkbreak = "\n";

    /**
     * Dumps a string to the console.
     *
     * @event  console_output  $string|$color
     * @param  string  $string  String to output
     *
     * @return  void
     */
    public function output($string, $options = array())
    {
        $defaults = array('lb' => "\n", 'color' => null);
        $options += $defaults;
        $this->setResultsStackable(true);
        fwrite(STDOUT, implode(LINE_BREAK, $this->console_output(array(
            $string,
            $options['color']
        ), array('object' => true))->getResults()));
        $this->clearResults();
    }

    /**
     * Provides a method to ask and receieve feedback via the console.
     *
     * The feedback generates the *console_feedback_title* event when received.
     *
     * @event  console_feedback_{title}
     * @param  string  $title  Title of feedback expected.
     * @param  string  $feedback  Question to ask.
     * @param  array  $options  Options to pass to output method
     *
     * @return  void
     */
    public function feedback($title, $feedback, $options = array())
    {
        $defaults = array('block' => false);
        $options += $defaults;
        $this->output($feedback, $options);
        if ($options['block']) {
            stream_set_blocking(STDOUT, 0);
        }
        $input = trim(fgets(STDIN));
        if ($options['block']) {
            stream_set_blocking(STDOUT, 1);
        }
        $this->setListener("console_feedback_$title");
        $this->trigger(array($input));
        return true;
    }
}
</pre>
    </li>
    <li>
        <h3>
            modules/commands.php
        </h3>
        <p>
            The commands object will be the workhorse of our console working as the main interactive object reciving and dispatching commands from the
            console.
        </p>
<pre class="prettyprint linenums">
namespace iconsole;

/**
 * Iconsole Prggmr Interactive Console
 *
 * @author Nickolas Whiting
 * @date February 17th, 2011
 */

/**
 * The command objects is the main workhorse of the console as
 * it is responsible.
 */

class Commands extends \iconsole\Console
{
    // user object
    public $_user = null;

    /**
     * Constructs the command console
     */
    public function __construct(User $user) {

        $this->_user = $user;
        $this->command();
    }

    /**
     * Command  is used to recieve input from the console as a new "command"
     * which will attempt to trigger a method within itself as the executed
     * command.
     *
     * Demonstrated with the following psuedo
     *
     * $command->command();
     * recieve input : test
     * check for test method in commands object
     * if true
     *      run test method
     * else
     *      dispatch invalid command message
     *
     * rerun command method
     *
     * @return  void
     */
    public function command()
    {
        $this->feedback('command', "Your wish is my command : \n");
    }

    /**
     * A simple example command which is triggered via the "test_command" command
     *
     * This method will execute a "feedback" asking a simple question.
     *
     * @return  void
     */
    public function test_command()
    {
        $this->feedback('test_command', 'What do you want me to do now ?  ');
    }
}
        </pre>
</ul>